(function(h){var k=window.AmazonUIPageJS||window.P,n=k._namespace||k.attributeErrors,c=n?n("PuffAuiAssets",""):k;c.guardFatal?c.guardFatal(h)(c,window):c.execute(function(){h(c,window)})})(function(h,k,n){h.when("A","PuffOrchestrator","PuffTrackingUtils","afterLoad").execute("PuffEntryPoint",function(c,a,f){f.startTimer(f.TOTAL_TIME_TIMER_NAME);a.orchestrate()});"use strict";h.when("A","PuffServiceHelper","PuffServiceResponseHandler","PuffSuppressionManager","PuffTrackingUtils","ready").register("PuffOrchestrator",
function(c,a,f,g,b){return{orchestrate:function(){try{g.isCurrentlySuppressed()?(b.recordTotalTime("ActiveSuppression"),b.recordTotalTime()):a.callGetContent().done(function(a,e,m){f.handleGetContentSuccess(a,e,m);b.recordTotalTime("Success")}).fail(function(a,e,m){f.handleGetContentError(a,e,m);b.recordTotalTime("Failed")}).always(function(){return b.recordTotalTime()})}catch(d){b.logError("Uncaught error during Puff orchestration. Due to: "+d.message),b.recordTotalTime("Failed"),b.recordTotalTime()}}}});
"use strict";h.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffServiceHelper",function(c,a,f){var g=function(){var a=f.getPageTypeValues();return{pageType:a.pageType,subPageType:a.subPageType,referrer:document.referrer,hostName:k.location.host,path:k.location.pathname,queryString:k.location.search}};return{callGetContent:function(){a.startTimer("GetContentTimer");return c.$.ajax("/puff/content",{data:{data:JSON.stringify(g())}}).done(function(b,d,e){a.recordTimer("GetContentTimer",
"GetContentTime:Success");a.recordTimer("GetContentTimer","GetContentTime:Status:"+e.status)}).fail(function(b,d,e){a.recordTimer("GetContentTimer","GetContentTime:Fail");a.recordTimer("GetContentTimer","GetContentTime:Status:"+b.status)}).always(function(){a.recordTimer("GetContentTimer","GetContentTime")})},callRecordImpression:function(b,d,e,m){d={periodicDisplayIdentifier:d,campaignIdentifier:e,placementIdentifier:m};d=c.$.extend({},g(),d);a.startTimer("RecordImpressionTimer");return c.$.ajax("/puff/impression",
{type:"POST",contentType:"application/json",headers:{"anti-csrftoken-a2z":b},data:JSON.stringify(d)}).done(function(e,b,t){a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Success");a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Status:"+t.status)}).fail(function(e,b,t){a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Fail");a.recordTimer("RecordImpressionTimer","RecordImpressionTime:Status:"+e.status)}).always(function(){a.recordTimer("RecordImpressionTimer","RecordImpressionTime")})},
callOptOut:function(b,d,e,m){d={periodicDisplayIdentifier:d,campaignIdentifier:e,placementIdentifier:m};d=c.$.extend({},g(),d);return c.$.ajax("/puff/opt-out",{type:"POST",contentType:"application/json",headers:{"anti-csrftoken-a2z":b},data:JSON.stringify(d)}).done(function(e,b,t){a.recordTimer("OptOutTimer","OptOutTime:Success");a.recordTimer("OptOutTimer","OptOutTime:Status:"+t.status)}).fail(function(e,b,t){a.recordTimer("OptOutTimer","OptOutTime:Fail");a.recordTimer("OptOutTimer","OptOutTime:Status:"+
e.status)}).always(function(){a.recordTimer("OptOutTimer","OptOutTime")})}}});"use strict";h.when("A","PuffTrackingUtils","PuffRequestAttributeUtils","ready").register("PuffSuppressionManager",function(c,a,f){var g=function(){return JSON.parse(localStorage.getItem("puff:suppression")||"{}")};return{isCurrentlySuppressed:function(){return a.runWithTimer(function(){try{var b,d=f.getSessionId();b=d?g()[d]:n;return Date.parse(b&&b.suppressUntil)>Date.now()}catch(e){return a.emitMetric("SuppressionCheckThrew"),
a.logError("Couldn't check suppression status. Defaulting to not suppressed. Message: "+e.message),!1}},"CheckIsSuppressedTime")},saveSuppression:function(b){return a.runWithTimer(function(){try{var d;var e=f.getSessionId();if(e)if(b.suppressUntil&&Date.parse(b.suppressUntil)){var m=g();m[e]=b;localStorage.setItem("puff:suppression",JSON.stringify(m));d=!0}else a.logError("Suppression not valid. Got: "+JSON.stringify(b)),d=!1;else a.logError("Can't save suppression. No sessionId available."),d=!1;
return d}catch(c){return a.emitMetric("SuppressionSaveThrew"),a.logError("Failed to save suppression. "+c.message),!1}},"SaveSuppressionTime")}}});"use strict";h.when("A","PuffSuppressionManager","PuffRenderingHandler","PuffTrackingUtils","PuffServiceHelper","ready").register("PuffServiceResponseHandler",function(c,a,f,g,b){var d=function(){return c.$(".nav-input")&&c.$(".nav-input").is(":focus")?(g.recordTotalTime("SearchActive"),!0):!1};return{handleGetContentSuccess:function(e,m,l){if(e&&204!==
l.status)switch(g.recordTotalTime(e.responseType),e.responseType){case "SUPPRESSION":a.saveSuppression(e.suppression);g.recordTotalTime("Suppressed");break;case "IMPRESSIONABLE_NO_RENDER":d()||(b.callRecordImpression(e.csrfToken,e.periodicDisplayIdentifier,e.campaignIdentifier,e.placementIdentifier),e.suppression&&(g.recordTotalTime("SuppressedAfterImpression"),a.saveSuppression(e.suppression)),g.recordTotalTime("ImpressionableNoRender"));break;case "RENDERED_FALLBACK":case "RENDERED_PRIMARY":if(!d()){try{c.$("body").append(e.content),
c.state.parse(),f.handle(e)}catch(B){throw g.emitMetric("DisplayFailed"),Error("Problem adding content to body or rendering. "+B.message);}g.recordTotalTime("Rendered")}break;default:g.logWarning("Got an unexpected responseType: "+e.responseType),g.recordTotalTime("UnsupportedResponseType")}else g.recordTotalTime("NoRender")},handleGetContentError:function(a,b,d){d="";try{d=JSON.parse(a.responseText).message}catch(c){d="Couldn't parse responseText. Got: "+(a.responseText&&a.responseText.substring(0,
200))}g.logError("Error calling puff service getContent. Status: "+a.status+". TextStatus: "+b+". Message: "+d)}}});"use strict";h.when("A","a-popover","PuffTrackingUtils","ready").register("PuffPopoverRenderer",function(c,a,f){var g=function(a,e){var g="a:popover:afterHide:"+a.contentId,f=m(e),p=f,h=f.parent().css("position");h&&"static"!==h.toLowerCase()||f.parent().css("position","relative");var f=l(f),q=function(){f.css({top:p.position().top,left:p.position().left})};c.$(k).bind("resize",q);d(g,
f,p,h,q);return b(a,f,g,e)},b=function(b,d,m,c){var g=e(b).detach(),f=c.customCssClass;c={name:b.contentId,inlineContent:g.addClass("show")[0].outerHTML,header:b.header,hideHeader:b.hideHeader,width:c.width,position:c.position};var l=a.create(d,c);l.lock().show();f&&l.$popover.addClass(f);return{dismissXEventName:"a:popover:dismiss:"+b.contentId,afterHideEventName:m,hideFunction:function(){l.unlock();l.hide()},displayedPuffContentSelector:l.getContent()}},d=function(b,d,e,m,f){c.on(b,function(b){a.remove(d);
d.remove();c.$(k).unbind("resize",f);e.parent().css("position",m)})},e=function(a){var b=c.$("#"+a.contentId);if(!b.length)throw f.emitMetric("PopoverRenderer:NoHiddenContent"),Error("No content for popover found at id: "+a.contentId);return b},m=function(a){var b=c.$(a.trigger);if(!b.length)throw f.emitMetric("PopoverRenderer:NoAnchorContent"),Error("No content to anchor popover to at: "+a.trigger);return b},l=function(a){var b=c.$("\x3cspan/\x3e").css({display:"block",width:a.outerWidth(!0),height:a.outerHeight(!0),
position:"absolute",top:a.position().top,left:a.position().left});b.insertAfter(a);return b};return{render:function(a,b){return f.runWithTimer(function(){return g(a,b)},"DisplayPopoverTime")}}});"use strict";h.when("A","PuffPopoverRenderer","PuffDismissHandler","PuffOptOutHandler","PuffServiceHelper","PuffSuppressionManager","PuffTrackingUtils","PuffCtaHandler","ready").register("PuffRenderingHandler",function(c,a,f,g,b,d,e,m){var l=["contentId","showHeader"],k=function(){var a=c.state("paladin-dynamic-content-state");
if(!a)throw e.emitMetric("NoDynamicState"),Error("No paladin-dynamic-content-state page state found.");l.forEach(function(b){if(!a[b])throw e.emitMetric("MissingDynamicStateKey"),Error("Puff dynamic state does not have value for: "+b);});return a};return{handle:function(c){var l;l=k();var h=c.type;switch(h){case "popover":l=a.render(l,c);break;default:throw Error("Invalid puff content type: "+h);}e.recordTotalTime("Displayed");e.emitEvent("smi_puff_impression",c.periodicDisplayIdentifier+":"+c.campaignIdentifier+
":"+c.placementIdentifier);b.callRecordImpression(c.csrfToken,c.periodicDisplayIdentifier,c.campaignIdentifier,c.placementIdentifier);c.suppression&&(e.recordTotalTime("SuppressedAfterImpression"),d.saveSuppression(c.suppression));var h=l.afterHideEventName,p=l.displayedPuffContentSelector;f.init(p,l.dismissXEventName,h,l.hideFunction,c);g.init(c,p,h);m.init(p,h,c)}}});"use strict";h.when("A","PuffServiceHelper","PuffTrackingUtils","ready").register("PuffOptOutHandler",function(c,a,f){var g=void 0,
b=void 0,d=void 0,e=void 0,m=!1,l=function(){m||(a.callOptOut(d.csrfToken,d.periodicDisplayIdentifier,d.campaignIdentifier,d.placementIdentifier),f.emitEvent("smi_puff_optOut",d.periodicDisplayIdentifier+":"+d.campaignIdentifier+":"+d.placementIdentifier),f.recordTimer("DisplayTimeUntilOptOut"),g.undelegate("a","click",h),c.off(e,k),m=!0)},h=function(a){c.$(a.currentTarget).hasClass("opt-out")&&l()},k=function(){0<b.find("input:checked").length&&l()};return{init:function(a,m,l){f.startTimer("DisplayTimeUntilOptOut");
g=m;e=l;b=g.find(".opt-out");d=a;g.delegate("a","click",h);c.on(l,k)}}});"use strict";h.when("A","PuffTrackingUtils","ready").register("PuffDismissHandler",function(c,a){var f=!1,g="dismiss_bkgrnd",b="Dismiss:Background",d=!1,e=!1,m=!1,l=void 0,h=void 0,k=void 0,n=void 0,r=void 0,p=void 0,v=void 0,q=function(a,c){d||(g=a,b=c,d=!0)},w=function(){q("dismiss_btn","Dismiss:Button")},x=function(){q("dismiss_x","Dismiss:X")},y=function(){m||(a.emitEvent("smi_puff_"+g,p.periodicDisplayIdentifier+":"+p.campaignIdentifier+
":"+p.placementIdentifier),a.recordTimer("DisplayTime"),a.emitMetric(b),m=!0);f||(k.unbind("click",w),c.off(h,x),c.off(l,y),r.undelegate("a","click",z),f=!0)},u=function(){e||f||(n(),e=!0)},C=function(){c.$("#nav-search").click(function(){q("dismiss_navSearch","Dismiss:NavSearch");u()})},A=function(a){v=c.delay(function(){q("dismiss_auto","Dismiss:Auto");u()},a)},D=function(){r.mouseenter(function(){clearTimeout(v)});r.mouseleave(function(){A(1E4)})},z=function(a){c.$(a.currentTarget).hasClass("opt-out")&&
(q("dismiss_optOut","Dismiss:OptOut"),u())};return{init:function(b,d,e,m,f){a.startTimer("DisplayTime");l=e;h=d;n=m;r=b;p=f;k=r.find(".dismiss");C();A(1E4);D();k.click(w);c.on(h,x);c.on(l,y);r.delegate("a","click",z)}}});"use strict";h.when("A","ready").register("PuffTrackingUtils",function(c){var a={},f=function(b){a[b]=Date.now()},g=function(b){return a[b]&&Date.now()-a[b]},b=function(a,b){var c=-1!==a.indexOf(b,a.length-b.length);return a+(c?"":b)},d=function(a){var c=1<arguments.length&&arguments[1]!==
n?arguments[1]:a,c=b(c,":ms"),d=g(a);d!==n&&e(c,d);return d},e=function(a){var c=1<arguments.length&&arguments[1]!==n?arguments[1]:1;k.ue&&k.ue.count&&(a=b(a,":"),k.ue.count("Paladin:PUFF:"+a,c))};return{TOTAL_TIME_TIMER_NAME:"TotalTime",emitMetric:e,emitEvent:function(a){var b=1<arguments.length&&arguments[1]!==n?arguments[1]:null;a&&"undefined"!==typeof k.csa&&k.csa("Events",{producerId:"ab-puff"})("log",{schemaId:"abpuff.schema.TrackingRecord.1",refTag:a,campaign:b})},startTimer:f,measureTimer:g,
runWithTimer:function(a,b){var c=2<arguments.length&&arguments[2]!==n?arguments[2]:b;f(b);var e=a();d(b,c);return e},recordTimer:d,recordTotalTime:function(){return d("TotalTime","TotalTime:"+(0<arguments.length&&arguments[0]!==n?arguments[0]:"ms"))},logWarning:function(a){h.log(a,"WARN","Paladin:PuffAuiAssets")},logError:function(a){h.log(a,"ERROR","Paladin:PuffAuiAssets")}}});"use strict";h.when("A","PuffTrackingUtils","ready").register("PuffRequestAttributeUtils",function(c,a){var f=function(){var b=
k.ue_pty;return b?b:(a.emitMetric("UeptyUnavailable"),n)},g=function(){var b=k.ue_spty;return b?b:(a.emitMetric("UesptyUnavailable"),n)};return{getPageTypeValues:function(){return k.uept?k.uept.pageType?{pageType:uept.pageType,subPageType:uept.subPageType||g()}:(a.emitMetric("UeptPageTypeUnavailable"),{pageType:f()||"Gateway",subPageType:uept.subPageType||g()}):(a.emitMetric("UeptUnavailable"),{pageType:f()||"Gateway",subPageType:g()})},getSessionId:function(){if(k.ue&&k.ue.sid)return k.ue.sid;a.emitMetric("UeSidUnavailable");
var b=k.ue_sid;b||a.emitMetric("Ue_SidUnavailable");return b}}});"use strict";h.when("A","PuffTrackingUtils","ready").register("PuffCtaHandler",function(c,a){var f=!1,g=!1,b=void 0,d=void 0,e=void 0,h=function(){f||(b.unbind("click",l),c.off(e,k),f=!0)},l=function(){g||(a.emitEvent("smi_puff_cta",d.periodicDisplayIdentifier+":"+d.campaignIdentifier+":"+d.placementIdentifier),a.recordTimer("DisplayUntilCta"),g=!0);h()},k=function(){h()};return{init:function(f,g,h){a.startTimer("DisplayUntilCta");e=
g;d=h;b=f.find(".puff-cta");b.click(l);c.on(g,k)}}})});